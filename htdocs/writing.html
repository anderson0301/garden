<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title>執筆用 | ●●● | マイホームブログ | Web屋の芝生DIY</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/shared/css/basic.css" media="all"></head><body class="lyt-main-sub turf"><div id="content"><main><div id="main-inner"><p class="main-visual"><img src="/wp-content/uploads/thum-turf.jpg" alt=""></p>


<!--======================================ここから記事用ソース======================================-->

<p>.load()メソッドを使った別ファイルのhtml取得はとても簡単ですが、「共通化や自動更新はしたいけどちょっとマークアップを変えたい」「同じ要素なんだけどもページごとに違う使い方をしたい」という場合、.load()メソッドだと限界があります。</p>
[adsense_top]
<p>そんな時、ajaxで別ページの要素を取得してDOM操作できると色々捗ります。本記事では、ajaxを活用した別ページのhtml取得方法についてご紹介させていただきたいと思います。</p>
<h2 class="hdg-l2-01">サンプルコード</h2>
<p>以下のようにdataType:'html'でajax通信することで、簡単に別ページのDOMが取得できます。</p>
<ul class="list-notice-01">
<li><span>※</span>ただし同ドメインのページに限ります（クロスドメイン不可）</li>
</ul>
<pre><code>$(function(){
  'use scrict';

  $.ajax({
    type:'GET',
    url:'/about/',
    dataType:'html'
  })
  .then(

    //通信成功時
    function(data){
      var contents = $(data).find('h1.hdg-l1-01').next();
      $('.hoge').append(contents);
    },
  
    //通信失敗時
    function(){
      alert("読み込み失敗");
  });
});</code></pre>
<p>上記は単純に取得した要素を.hogeの中に放り込んでいるだけなので、.load()と対してやっていることは変わりませんが、DOM操作してからappendすることで、同じ要素でも全く違った見せ方にすることもできます。</p>
<p>例えば以下のサンプルコードでは、<a href="/about/">/about/</a>のH1テキストを取得して文字列を置換し、さらにリンクリストモジュールの形式にDOM操作してからappendしています。</p>
<pre><code>$(function(){
  'use scrict';

  $.ajax({
    type:'GET',
    url:'/about/',
    dataType:'html'
  })
  .then(

    //通信成功時
    function (data) {
      var contents = $(data).find('h1.hdg-l1-01').next().text();
      contents = contents.replace(contents,'サイトについて');
      contents = '&lt;ul class=&quot;list-link-01&quot;&gt;&lt;li&gt;&lt;a href=&quot;/about/&quot;&gt;' + contents + '&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;';
      $('.moge').append(contents);
    },
  
    //通信失敗時
    function () {
      alert("読み込み失敗");
  });
});</code></pre>
<ul class="list-notice-01">
<li><span>※</span><a href="https://jquery.com/" target="_blank" class="blank">jQuery</a>を読み込んでいる場合のスクリプトとなります</li>
</ul>
[adsense_middle]
<h2 class="hdg-l2-01">解説</h2>
<p>ajaxで取得したオブジェクトはdataに格納されます。あとは取得したい任意の要素に$(data)〜でアクセスするだけです。同ページ内にある要素と同じ感覚で扱うことができるようになります。</p>
<p>わかりづらくなりそうだったのであえて用意しませんでしたが、例えばfor文やeach()を活用し、複数ある要素をAのページではリストで見せているんだけど、Bのページではセレクトボックスとして扱いたい、などの場合にこの手法は力を発揮します。</p>
<p><strong>「Aのページをメンテナンスすれば体裁の違うBのページも勝手に更新される」</strong>という仕組みを、ちょっとしたスクリプトを書けば作り出すことができるわけです。</p>
<p>まあ.load()を使っても似たようなことはできなくも無いですが、処理としては.load()後に要素を取得して一旦非表示にして、DOM操作してからまたappend、みたいなことをやらなきゃなのでコードも増えますし、処理としては美しくないんですよね。</p>
<ul class="list-notice-01">
<li><span>※</span>決して.load()をディスっているわけではない</li>
</ul>
<p>また、PCとSP用で別々にhtmlを用意しているサイトなどの場合、新着情報やお知らせにおいて、<strong>「PCサイトを更新すればSPも更新される」</strong>といった仕組みで運用工数を減らす活用方法もあります。</p>
<h2 class="hdg-l2-01">デモ</h2>
<p>実際に動作を確認できるデモページも公開しておりますのであわせてご確認ください。</p>
<ul class="list-link-01">
<li><a href="/demo/180323_01/" target="_blank">jQueryで別ページのhtmlを取得してDOM操作する方法</a></li>
</ul>
<h2 class="hdg-l2-01">まとめ</h2>
<p>以上、別ページのhtmlを取得してDOM操作する方法をご紹介させていただきました。実際、サイトの機能としてこういったものを実装するケースはあまりないかもしれません。</p>
<p>しかし<strong>「ajaxを使って別ページのhtmlを簡単に扱うことができる」</strong>ということを知っておくと、いざという時に便利ですので、ご参考になれば幸いです。</p>




<!--======================================ここまで記事用ソース======================================-->

<!--
<p><img src="/images/blog/2018/02/XX_01_XX.jpg" alt="" width="660" height=""></p>
<h2 class="hdg-l2-01">まとめ</h2>
<p></p>
-->

</div><!--/#main-inner--></main></div><!--/#content--><p class="page_top"><a href="#">ページの先頭に戻る</a></p><footer><p>&copy;2016 Web屋の芝生DIY All rights reserved.</p></footer><script src="//code.jquery.com/jquery-2.2.4.min.js"></script><script src="/shared/js/init.js"></script><script></script></body></html>