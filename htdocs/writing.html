<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title>執筆用 | ●●● | マイホームブログ | Web屋の芝生DIY</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/shared/css/basic.css" media="all"></head><body class="lyt-main-sub turf"><div id="content"><main><div id="main-inner"><p class="main-visual"><img src="/wp-content/uploads/thum-turf.jpg" alt=""></p>


<!--======================================ここから記事用ソース======================================-->

<p>Chromeが警告を出すように立ったことをきっかけに、世界的に急速に進んでいるWebサイトのSSL化ですが、<strong>「httpsからhttpへの遷移ではリファラを渡せない」</strong>という問題があります。そこで本記事ではhtmlにmetaタグを1行追加するだけで、リファラを渡すようにすることができる方法をご紹介させていただきたいと思います。</p>
[adsense_top]
<h2 class="hdg-l2-01">本来はリファラを渡すべきではない</h2>
<p><a href="https://triple-underscore.github.io/RFC2616-ja.html" target="_blank">RFC2616</a>では以下のように記載があります。</p>
<blockquote>
<p>クライアントは、参照されるページがセキュアプロトコルで転送された場合は、（セキュアで無い）HTTPリクエストにRefererヘッダフィールドを含むべきではない。</p>
</blockquote>
<h2 class="hdg-l2-01">新仕様「meta="referrer"」を使う</h2>
<p>httpsからhttpの際に渡せないリファラですが、以下のmetaタグによりクライアント側でリファラポリシーを制御することができます。</p>
<pre><code>&lt;meta name="referrer" content="任意の値を記述"&gt;</code></pre>
<h3 class="hdg-l3-01">設定できる値</h3>
<table class="tbl-01 sp-lyt-on">
<tbody>
<tr>
<th class="w-40">none</th>
<td>記述したページからリファラを渡さない</td>
</tr>
<tr>
<th>origin</th>
<td>記述したページからドメイン名のみのリファラを渡す
<ul class="list-notice-01 mb0">
<li><span>※</span>https://hoge.jp/hoge.htmからは「https://hoge.jp/」のみを渡す</li>
</ul></td>
</tr>
<tr>
<th>none-when-downgrade</th>
<td>現在の動作と同じ
<ul class="list-notice-01 mb0">
<li><span>※</span>HTTPS→HTTPではリファラを渡さない</li>
<li><span>※</span>HTTPS→HTTP以外の遷移は全URLをリファラとして渡す</li>
</ul></td>
</tr>
<tr>
<th>origin-when-crossorigin</th>
<td>同ドメインによるHTTP/HTTPSの種類も同じURLへの移動であれば全URLをリファラとして渡す
<ul class="list-notice-01 mb0">
<li><span>※</span>それ以外はドメイン名のみのリファラを渡す</li>
</ul></td>
</tr>
<tr>
<th>unsafe-url</th>
<td>HTTPS、HTTP関係なく全URLをリファラとして渡す</td>
</tr>
</tbody>
</table>
<p>つまり、記事タイトルの「httpsからhttpにリファラを渡す方法」を実現するには、以下のように値を「unsafe-url」とすればOKです。</p>
<pre><code>&lt;meta name="referrer" content="unsafe-url"&gt;</code></pre>
[adsense_middle]
<h2 class="hdg-l2-01">実装されているのは一部のブラウザのみ</h2>
<p>ただしこのmetaを記述すればリファラ問題が完全に解決するかといえばそうでもなく、一部のブラウザでの実装に留まっています。</p>
<h3 class="hdg-l3-01">meta name="referrer"が実装されているブラウザ</h3>
<ul class="list-bullet-01">
<li>Firefox</li>
<li>Chrome</li>
</ul>
<ul class="list-notice-01">
<li><span>※</span>2018年4月30日時点</li>
</ul>
<p>Safariで実装されていないのが痛いですね。iPhoneでも渡せるようになれば、かなり精緻な値が期待できるのですが。</p>
<h2 class="hdg-l2-01">サーバ側で同様の設定をすることも可能</h2>
<p>以下のページで詳しく解説されていますが、サーバ側でReferrer-Policyヘッダーにてmetaタグ同様の値を指定することもできるようです。</p>
<ul class="list-link-01">
<li><a href="https://qiita.com/wakaba@github/items/707d72f97f2862cd8000" target="_blank">Referrerを制御する</a></li>
</ul>
<h2 class="hdg-l2-01">まとめ</h2>
<p>meta name="referrer"は一部のブラウザでしか実装されていないのが難点ですが、htmlに記述するだけでhttpsからhttpへの遷移でもリファラが渡せるようになるのはありがたいことですね。</p>
<p>SSL化に合わせてSafari含め他のブラウザが追随することを期待して<strong>「とりあえず記述しておく」</strong>という考え方でも良いと思います。どうぞ本記事がご参考になれば幸いです。</p>



<!--======================================ここまで記事用ソース======================================-->

<!--
<p><img src="/images/blog/2018/02/XX_01_XX.jpg" alt="" width="660" height=""></p>
<h2 class="hdg-l2-01">まとめ</h2>
<p></p>
-->

</div><!--/#main-inner--></main></div><!--/#content--><p class="page_top"><a href="#">ページの先頭に戻る</a></p><footer><p>&copy;2016 Web屋の芝生DIY All rights reserved.</p></footer><script src="//code.jquery.com/jquery-2.2.4.min.js"></script><script src="/shared/js/init.js"></script><script></script></body></html>