<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title>執筆用 | ●●● | マイホームブログ | Web屋の芝生DIY</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/shared/css/basic.css" media="all"></head><body class="lyt-main-sub turf"><div id="content"><main><div id="main-inner"><p class="main-visual"><img src="/wp-content/uploads/thum-turf.jpg" alt=""></p>


<!--======================================ここから記事用ソース======================================-->

<p>よくブログで実装されているイメージですが、企業サイトなどでもページをある程度スクロールすると、サイドバーが固定されているのをご覧になったことがあるかと思います。サイトの基本設計やサイドバーを上下どちらに固定するかなどで実装方法は様々ですが、今回Web屋の芝生DIYでは<strong>「サイドバーを下に固定」</strong>する実装を行いました。</p>
[adsense_top]
<p>そこで本記事では、<strong>「プラグインを使用せずレスポンシブにサイドバーを下に固定する方法」</strong>についてご紹介させていただきたいと思います。</p>
<h2 class="hdg-l2-01">サンプルソース</h2>
<h3 class="hdg-l3-01">html</h3>
<pre><code>&lt;header&gt;
&lt;!--ヘッダー要素--&gt;
&lt;/header&gt;
&lt;div id=&quot;content&quot;&gt;

&lt;main&gt;
&lt;div id=&quot;main-inner&quot;&gt;
&lt;!--メインコンテンツ要素--&gt;
&lt;/div&gt;
&lt;/main&gt;

&lt;div id=&quot;nav-sidebar&quot;&gt;
&lt;div id=&quot;nav-sidebar-inner&quot;&gt;
&lt;!--サイドバー要素--&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;!--/#content--&gt;
&lt;footer&gt;
&lt;!--フッター要素--&gt;
&lt;/footer&gt;</code></pre>

<h3 class="hdg-l3-01">css</h3>
<pre><code>//ヘッダーのcssを定義
header{
}

//フッターのcssを定義
footer{
}

//コンテンツ全体のcssを定義（max-widthなど）
#content{
}

//メインカラムのcssを定義（float:left;やwidth:XXXなど）
#content main{
}

//メインカラムのcssを定義（余白調整や角丸など）
#content main #main-inner{
}

//サイドバー全体のcssを定義（float:right;やwidth:XXXなど）
div#nav-sidebar{
}

//スクロール固定中のclass
div#nav-sidebar-inner.fixed-side{
　　position:fixed;
　　bottom:0;
}

//フッターに到達時のclass
div#nav-sidebar-inner.bottom-side{
　　position:absolute;
}

//メディアクエリ（1カラム時はposition:static）
@media screen and (max-width:850px){
  div#nav-sidebar-inner.fixed-side{
    position:static;
  }
  div#nav-sidebar-inner.bottom-side{
    position:static;
  }
}</code></pre>
<h3 class="hdg-l3-01">js</h3>
<pre><code>(function(){

$(window).on("load scroll resize",function(){
  var sidebarFix = function(){

    //スクロールバー込みの画面幅
    var w = window.innerWidth;

    //サイドバー有無の境界幅
    var x = 851;

    if(w >= x){

      //各要素の高さを取得 
      var $winH = $(window).height();//ウィンドウの高さ
      var $pageH = $('body').height();//bodyの高さ
      var $headerH = $('header').outerHeight(true);//ヘッダーの高さ
      var $mainH = $('#main-inner').outerHeight(true);//メインカラムの高さ
      var $sideH = $('#nav-sidebar-inner').outerHeight(true);//サイドバーの高さ
      var $footerH = $('footer').outerHeight(true);//フッターの高さ
      var $paddingH = $('#content').outerHeight(true) - $('#content').height();//余白の高さ

      //サイドバーの固定と解除条件を計算 
      var $fixedSide = ($headerH + $paddingH + $sideH) - $winH;//サイドバーを固定するスクロール高さ
      var $scrollBtm = $pageH - $winH - $footerH ;//フッターが画面に表示されるスクロール高さ

      //スクロール値を取得 
      var $scrollTop = $(this).scrollTop();

      //記事がサイドバーより長い場合実行
      if($mainH > $sideH){

        //サイドバー下端までスクロールしたらサイドバー下端で追従
        if($scrollTop > $fixedSide){

          //サイドバー固定のクラス付与
          $('#nav-sidebar-inner').addClass('fixed-side').css('bottom',0);

          //サイドバー固定時のサイドバー幅を計算
          var $sidebarW = $('#nav-sidebar').width();

          //計算したサイドバー幅を付与
          $('#nav-sidebar-inner').css("width",$sidebarW);

        //条件から外れたら固定クラスを削除し幅をリセット
        }else{

          //サイドバー固定のクラス削除
          $('#nav-sidebar-inner').removeClass('fixed-side');

          //サイドバー幅リセット
          $('#nav-sidebar-inner').css('width','auto');
        }
        //フッターまでスクロールしたらサイドバー下端をフッター上端に連結
        if($scrollTop > $scrollBtm){
          $('#nav-sidebar-inner').removeClass('fixed-side').css('bottom',0);
          $('#nav-sidebar-inner').addClass('bottom-side').css('bottom',$footerH);

        //条件から外れたらクラスを削除
        }else{
          $('#nav-sidebar-inner').removeClass('bottom-side').css('bottom',0);
        }
      }

    //サイドバーがない場合に適用
    }else{
      $('#nav-sidebar-inner').css('width','auto');
    }
  };sidebarFix();
});
})(jQuery);</code></pre>
<h2 class="hdg-l2-01">解説</h2>
<p>実装に当たって、以下の記事を参考にさせていただきました。</p>
<ul class="list-link-01">
<li><a href="https://hm-solution.jp/web/post3105.html" target="_blank">サイドメニューが下まで行ったらそこで固定するJS（jQuery）</a></li>
<li><a href="http://tsumaboku.com/fix-the-sidebar" target="_blank">レスポンシブ対応！幅が比率指定のサイドバーを下端で追従させる方法－WordPress（Twenty Seventeen）</a></li>
</ul>
<p>まずは変数wにスクロールバー込みの画面幅を格納し、変数xではサイドバー固定を実行するブレイクポイントを定義します。次に「if(w >= x){～」で、<strong>「ブレイクポイントよりも画面幅が大きい場合」</strong>のみ、サイドバー固定を実行する条件分岐を行います。</p>
<p>if文の中で、サイドバー固定の計算に必要な各要素の値を変数に格納します。続けて、変数$fixedSideには<strong>「ヘッダー + コンテンツ全体の余白 + サイドバー」</strong>を足した値からウインドウの高さを引くことで、サイドバーを固定するスクロールの高さを定義します。さらに、変数$scrollBtmにはbodyからウインドウとフッターの高さを引くことで、フッター到達時にサイドバーがフッター上部で固定するスクロールの高さを定義しています。</p>
<p>続けて、実際にサイドバーを固定する処理の記述になります。そもそもメインカラムがサイドバーより短い場合はサイドバー固定を実行する必要はないので、<strong>「if($mainH > $sideH){～」</strong>でさらに条件分岐し、処理を行います。</p>
<p>if($scrollTop > $fixedSide){～にてフッター上部までサイドバー固定用のcssを付与します。ポイントは、<strong>#nav-sidebar-innerにwidthを設定する点</strong>です。#nav-sidebar-innerはposition:fixedになるため、<strong>包括している#nav-sidebarのwidthが適用されなくなり幅が変わってしまいます。</strong>そのため、#nav-sidebarのwidthを#nav-sidebar-innerにも適用してあげる必要があります。</p>
<p>else{～では付与したclassを外し、widthの値もautoにリセットします。</p>
<p>if($scrollTop > $scrollBtm){～にて、フッター到達時の処理を行います。サイドバー固定用のclassを外し、フッター到達時用のclassを付与します。ポイントは、レスポンシブでフッターの高さが可変になることを考慮し、<strong>固定値ではなく変数$footerHに格納しておいたフッターの高さをbottomに付与する点</strong>です。これにより、レスポンシブに対応したサイドバー固定が可能になります。</p>
<p>最後に、条件から外れた場合はフッター到達時のclassを外します。</p>
<h2 class="hdg-l2-01">まとめ</h2>
<p>ブログ記事はそこまで内容が短いものでなければ、サイドバーよりメインコンテンツが長くなるケースが多いかと思いますが、ある程度スクロールすれば当然サイドバーには何もなくなります。そんな時、サイドバー固定を実装しておくことで、空いたスペースを有効活用することが可能になります。</p>
<p>ご紹介した方法は、プラグインも使用せずレスポンシブにも対応しているので非常におすすめです。サイトの設計に応じてセレクタ指定やブレイクポイントは多少弄ぶ必要はありますが、なるべく汎用的なソースとしてご紹介させていただきましたので、ぜひご参考にしていただければ幸いです。</p>





<!--======================================ここまで記事用ソース======================================-->

<!--
<p><img src="/images/blog/2018/02/XX_01_XX.jpg" alt="" width="660" height=""></p>
<h2 class="hdg-l2-01">まとめ</h2>
<p></p>
-->

</div><!--/#main-inner--></main></div><!--/#content--><p class="page_top"><a href="#">ページの先頭に戻る</a></p><footer><p>&copy;2016 Web屋の芝生DIY All rights reserved.</p></footer><script src="//code.jquery.com/jquery-2.2.4.min.js"></script><script src="/shared/js/init.js"></script><script></script></body></html>